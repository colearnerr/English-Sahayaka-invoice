<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: auto; border: 1px solid #ddd; }
        .header { text-align: right; }
        .header h1 { font-size: 24px; margin: 0; }
        .company-details { text-align: left; margin-bottom: 40px; }
        .company-details p { margin: 4px 0; }
        .logo { max-width: 150px; margin-bottom: 20px; display: block; }
        .invoice-details { width: 100%; margin-bottom: 20px; }
        .invoice-details th, .invoice-details td { text-align: left; padding: 8px; }
        .invoice-details th { background-color: #f4f4f4; }
        .client-details, .bill-to { margin-bottom: 20px; }
        .bill-to h2 { font-size: 18px; margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f4f4f4; }
        .total-section { text-align: right; margin-top: 20px; }
        .balance-due { font-size: 20px; font-weight: bold; }
        .btn { padding: 10px 15px; cursor: pointer; margin: 5px; background-color: #4CAF50; color: white; border: none; }
        .remove-btn { background-color: #f44336; }
        .input-group { display: flex; flex-direction: column; gap: 10px; }
        input { width: 100%; box-sizing: border-box; }
    </style>
</head>
<body id="invoice">
    <div class="header">
        <h1>INVOICE</h1>
        <p id="invoice-number">INV0003</p>
    </div>

    <div class="company-details">
        <img src="data:image/png;base64,{{BASE64_STRING}}" alt="Company Logo" class="logo">
        <p><strong>English Sahayaka</strong></p>
        <p>3rd floor, 1537, 5th Cross Road, Rajiv Gandhi Nagar, Agara Village, 1st Sector, HSR Layout, Bengaluru</p>
        <p>Email: englishsahayaka@gmail.com</p>
        <p>Phone: 8050177159</p>
    </div>

    <div class="bill-to">
        <h2>Bill To</h2>
        <div class="input-group">
            <label for="client-name">Client Name:</label>
            <input type="text" id="client-name" value="" placeholder="Enter client name">

            <label for="client-phone">Client Phone:</label>
            <input type="tel" id="client-phone" value="" placeholder="Enter client phone">

            <label for="client-email">Client Email:</label>
            <input type="email" id="client-email" value="" placeholder="Enter client email">
        </div>
    </div>

    <table class="invoice-details">
        <tr>
            <th>Date</th>
            <td><input type="date" id="invoice-date"></td>
        </tr>
        <tr>
            <th>Due Date</th>
            <td><input type="text" id="due-date" placeholder="Enter due date"></td>
        </tr>
    </table>

    <table id="invoice-table">
        <thead>
            <tr>
                <th>Description</th>
                <th>Rate (INR ₹)</th>
                <th>Qty</th>
                <th>Discount (INR ₹)</th>
                <th>Amount (INR ₹)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" value=""></td>
                <td><input type="number" value="" oninput="calculateTotal()"></td>
                <td><input type="number" value="" oninput="calculateTotal()"></td>
                <td><input type="number" value="" oninput="calculateTotal()"></td>
                <td><input type="number" value="" readonly></td>
            </tr>
        </tbody>
    </table>

    <div class="total-section">
        <p class="balance-due">Balance Due: INR ₹<span id="balance-due">0.00</span></p>
    </div>

    <button class="btn" onclick="generateNewInvoice()">Generate New Invoice</button>
    <button class="btn" onclick="downloadPDF()">Download PDF</button>

    <script>
        let invoiceNumber = 3;

        function generateNewInvoice() {
            invoiceNumber++;
            document.getElementById('invoice-number').textContent = 'INV' + String(invoiceNumber).padStart(4, '0');
            calculateTotal();
        }

        function calculateTotal() {
            const rows = document.querySelectorAll('#invoice-table tbody tr');
            let total = 0;
            rows.forEach(row => {
                const rate = parseFloat(row.cells[1].querySelector('input').value) || 0;
                const qty = parseFloat(row.cells[2].querySelector('input').value) || 0;
                const discount = parseFloat(row.cells[3].querySelector('input').value) || 0;
                const amount = (rate * qty) - discount;
                row.cells[4].querySelector('input').value = amount.toFixed(2);
                total += amount;
            });
            document.getElementById('balance-due').textContent = total.toFixed(2);
        }

        function downloadPDF() {
            const element = document.getElementById('invoice');
            html2pdf().from(element).save('Invoice_' + document.getElementById('invoice-number').textContent + '.pdf');
        }
    </script>
</body>
</html>
